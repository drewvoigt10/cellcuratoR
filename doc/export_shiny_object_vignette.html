<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>export_shiny_object_vignette</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">export_shiny_object_vignette</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>This vignette will walk through the exportation of a processed seurat object that is compatible with the cellcuratoR shiny visualization system. Compatible S4 Seurat input objects should be supplied by the user that have either (A) been processed with Seuart (version 3) or (B) been updated to a version 3 Seurat object with the function UpdateSeuratObject(). Further, within the meta.data of the Seurat object, the user should have columns corresponding to a final cluster designation, a library-id, and a cell type classification, as walked through in this tutorial.</p>
<p>We will walk through the exportation of a stimulated vs control pbmc dataset freely available from Seurat. We will use the ifnb data, in which peripheral blood mononuclear cells were divided into stimulated and control groups. For further details, see <a href="https://satijalab.org/seurat/v3.1/immune_alignment.html" class="uri">https://satijalab.org/seurat/v3.1/immune_alignment.html</a>. First, we will download the ifnb dataset using the helpful SeuratData package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(cellcuratoR)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; Registered S3 method overwritten by &#39;R.oo&#39;:</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt;   method        from       </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt;   throw.default R.methodsS3</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(Seurat)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; ── Attaching packages ────────────────────────────────────── tidyverse 1.2.1 ──</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; ✔ ggplot2 3.2.1     ✔ purrr   0.3.2</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; ✔ tibble  2.1.3     ✔ dplyr   0.8.5</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; ✔ tidyr   1.0.0     ✔ stringr 1.4.0</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; ✔ readr   1.3.1     ✔ forcats 0.4.0</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; ── Conflicts ───────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">requireNamespace</span>(<span class="st">&quot;SeuratData&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)){</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="kw">stop</span>(<span class="st">&quot;Package </span><span class="ch">\&quot;</span><span class="st">SeuratData</span><span class="ch">\&quot;</span><span class="st"> needed for this vignette to work. Please install it.&quot;</span>,</span>
<span id="cb1-18"><a href="#cb1-18"></a>      <span class="dt">call. =</span> <span class="ot">FALSE</span>)</span>
<span id="cb1-19"><a href="#cb1-19"></a>}</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw">library</span>(SeuratData)</span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt; ── Installed datasets ──────────────────────────────────── SeuratData v0.2.1 ──</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt; ✔ ifnb   3.0.0                         ✔ pbmc3k 3.0.0</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#&gt; ✔ panc8  3.0.2</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt; ───────────────────────────────────── Key ─────────────────────────────────────</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; ✔ Dataset loaded successfully</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; ❯ Dataset built with a newer version of Seurat than installed</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; ❓ Unknown version of Seurat installed</span></span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="kw">InstallData</span>(<span class="st">&quot;ifnb&quot;</span>) </span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#&gt; Warning: The following packages are already installed and will not be</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#&gt; reinstalled: ifnb</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="kw">data</span>(<span class="st">&quot;ifnb&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">head</span>(ifnb<span class="op">@</span>meta.data)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt;                   orig.ident nCount_RNA nFeature_RNA stim</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; AAACATACATTTCC.1 IMMUNE_CTRL       3017          877 CTRL</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; AAACATACCAGAAA.1 IMMUNE_CTRL       2481          713 CTRL</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt; AAACATACCTCGCT.1 IMMUNE_CTRL       3420          850 CTRL</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; AAACATACCTGGTA.1 IMMUNE_CTRL       3156         1109 CTRL</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; AAACATACGATGAA.1 IMMUNE_CTRL       1868          634 CTRL</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; AAACATACGGCATT.1 IMMUNE_CTRL       1581          557 CTRL</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;                  seurat_annotations</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; AAACATACATTTCC.1          CD14 Mono</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; AAACATACCAGAAA.1          CD14 Mono</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; AAACATACCTCGCT.1          CD14 Mono</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; AAACATACCTGGTA.1                pDC</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; AAACATACGATGAA.1       CD4 Memory T</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; AAACATACGGCATT.1          CD14 Mono</span></span></code></pre></div>
<p>We will perform a basic integration and clustering analysis, as outlined by the Seurat team.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>ifnb.list &lt;-<span class="st"> </span><span class="kw">SplitObject</span>(ifnb, <span class="dt">split.by =</span> <span class="st">&quot;stim&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a>ifnb.list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dt">X =</span> ifnb.list, <span class="dt">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-4"><a href="#cb3-4"></a>    x &lt;-<span class="st"> </span><span class="kw">NormalizeData</span>(x)</span>
<span id="cb3-5"><a href="#cb3-5"></a>    x &lt;-<span class="st"> </span><span class="kw">FindVariableFeatures</span>(x, <span class="dt">selection.method =</span> <span class="st">&quot;vst&quot;</span>, <span class="dt">nfeatures =</span> <span class="dv">2000</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>})</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>immune.anchors &lt;-<span class="st"> </span><span class="kw">FindIntegrationAnchors</span>(<span class="dt">object.list =</span> ifnb.list, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; Computing 2000 integration features</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; Scaling features for provided objects</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; Finding all pairwise anchors</span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; Running CCA</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; Merging objects</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; Finding neighborhoods</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; Finding anchors</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt;  Found 15696 anchors</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; Filtering anchors</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt;  Retained 6385 anchors</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; Extracting within-dataset neighbors</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">IntegrateData</span>(<span class="dt">anchorset =</span> immune.anchors, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; Merging dataset 1 into 2</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; Extracting anchors for merged samples</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; Finding integration vectors</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; Finding integration vector weights</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; Integrating data</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="kw">DefaultAssay</span>(immune.combined) &lt;-<span class="st"> &quot;integrated&quot;</span></span>
<span id="cb3-27"><a href="#cb3-27"></a></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co"># Run the standard workflow for visualization and clustering</span></span>
<span id="cb3-29"><a href="#cb3-29"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">ScaleData</span>(immune.combined, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb3-30"><a href="#cb3-30"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">RunPCA</span>(immune.combined, <span class="dt">npcs =</span> <span class="dv">30</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co"># t-SNE and Clustering</span></span>
<span id="cb3-32"><a href="#cb3-32"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">RunUMAP</span>(immune.combined, <span class="dt">reduction =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt; Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; To use Python UMAP via reticulate, set umap.method to &#39;umap-learn&#39; and metric to &#39;correlation&#39;</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; This message will be shown once per session</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; 12:55:10 Read 13999 rows and found 20 numeric columns</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">#&gt; 12:55:10 Using Annoy for neighbor search, n_neighbors = 30</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">#&gt; 12:55:10 Building Annoy index with metric = cosine, n_trees = 50</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">#&gt; 0%   10   20   30   40   50   60   70   80   90   100%</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="co">#&gt; [----|----|----|----|----|----|----|----|----|----|</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">#&gt; **************************************************|</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="co">#&gt; 12:55:12 Writing NN index file to temp file /var/folders/nl/mgz6zyb95zbgxdht85f6p5j8020vg6/T//RtmptVxGA7/file127c2de877fd</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">#&gt; 12:55:12 Searching Annoy index using 1 thread, search_k = 3000</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="co">#&gt; 12:55:16 Annoy recall = 100%</span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="co">#&gt; 12:55:16 Commencing smooth kNN distance calibration using 1 thread</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="co">#&gt; 12:55:17 Initializing from normalized Laplacian + noise</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="co">#&gt; 12:55:17 Commencing optimization for 200 epochs, with 606454 positive edges</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="co">#&gt; 12:55:25 Optimization finished</span></span>
<span id="cb3-49"><a href="#cb3-49"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">FindNeighbors</span>(immune.combined, <span class="dt">reduction =</span> <span class="st">&quot;pca&quot;</span>, <span class="dt">dims =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)</span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="co">#&gt; Computing nearest neighbor graph</span></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="co">#&gt; Computing SNN</span></span>
<span id="cb3-52"><a href="#cb3-52"></a>immune.combined &lt;-<span class="st"> </span><span class="kw">FindClusters</span>(immune.combined, <span class="dt">resolution =</span> <span class="fl">0.5</span>)</span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="co">#&gt; Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="co">#&gt; </span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="co">#&gt; Number of nodes: 13999</span></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="co">#&gt; Number of edges: 533933</span></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="co">#&gt; </span></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="co">#&gt; Running Louvain algorithm...</span></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="co">#&gt; Maximum modularity in 10 random starts: 0.9058</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="co">#&gt; Number of communities: 13</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="co">#&gt; Elapsed time: 2 seconds</span></span>
<span id="cb3-62"><a href="#cb3-62"></a></span>
<span id="cb3-63"><a href="#cb3-63"></a><span class="co"># We map each cluster to a putative cell type</span></span>
<span id="cb3-64"><a href="#cb3-64"></a>seurat_celltypes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CD14 Mono&quot;</span>, <span class="st">&quot;CD4 Naive T&quot;</span>, <span class="st">&quot;CD4 Memory T&quot;</span>, </span>
<span id="cb3-65"><a href="#cb3-65"></a>                      <span class="st">&quot;CD16 Mono&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;CD8 T&quot;</span>, <span class="st">&quot;T activated&quot;</span>, </span>
<span id="cb3-66"><a href="#cb3-66"></a>                      <span class="st">&quot;NK&quot;</span>, <span class="st">&quot;DC&quot;</span>, <span class="st">&quot;B Activated&quot;</span>, <span class="st">&quot;Mk&quot;</span>,  <span class="st">&quot;pDC&quot;</span>, <span class="st">&quot;Eryth&quot;</span>)</span>
<span id="cb3-67"><a href="#cb3-67"></a>celltype &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw">mapvalues</span>(<span class="dt">x =</span> immune.combined<span class="op">@</span>meta.data<span class="op">$</span>seurat_clusters, </span>
<span id="cb3-68"><a href="#cb3-68"></a>                                <span class="dt">from =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="dv">12</span>), </span>
<span id="cb3-69"><a href="#cb3-69"></a>                                <span class="dt">to =</span> seurat_celltypes)</span>
<span id="cb3-70"><a href="#cb3-70"></a>immune.combined<span class="op">@</span>meta.data<span class="op">$</span>celltype &lt;-<span class="st"> </span>celltype</span>
<span id="cb3-71"><a href="#cb3-71"></a></span>
<span id="cb3-72"><a href="#cb3-72"></a><span class="co"># We add a treatment column to the seurat object so that differential expression can </span></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="co"># be performed between unstimulated and stimulated samples. Treatment must be a binary factor. </span></span>
<span id="cb3-74"><a href="#cb3-74"></a>treatment &lt;-<span class="st"> </span><span class="kw">as.factor</span>(immune.combined<span class="op">@</span>meta.data<span class="op">$</span>orig.ident)</span>
<span id="cb3-75"><a href="#cb3-75"></a>immune.combined<span class="op">@</span>meta.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(immune.combined<span class="op">@</span>meta.data, treatment)</span></code></pre></div>
<p>Before interacting with the data, we must export the processed seurat object in a format interpretable by Shiny. First, we create a directory to organize all of our exported cellcuratoR objects:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## consider changing filepath to ~/Desktop or other directory that is easier to navigate to</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>my_filepath &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">find.package</span>(<span class="st">&quot;cellcuratoR&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">dir.create</span>(<span class="kw">file.path</span>(my_filepath, <span class="st">&quot;my_cellcuratoR_objects/&quot;</span>))</span></code></pre></div>
<p>Next, we export our processed Seurat object into this newly created directory with the export_shiny_object() function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">export_shiny_object</span>(<span class="dt">seurat_object =</span> immune.combined, </span>
<span id="cb5-2"><a href="#cb5-2"></a>                    <span class="dt">final_cluster_column_name =</span> <span class="st">&quot;seurat_clusters&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>                    <span class="dt">library_id_column_name =</span> <span class="st">&quot;orig.ident&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>                    <span class="dt">classification_column_name =</span> <span class="st">&quot;celltype&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>                    <span class="dt">create_dendrogram =</span> <span class="ot">TRUE</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>                    <span class="dt">custom_cluster_colors =</span> <span class="ot">FALSE</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>                    <span class="dt">custom_library_colors =</span> <span class="ot">FALSE</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>                    <span class="dt">additional_metadata_cols =</span> <span class="kw">c</span>(<span class="st">&quot;treatment&quot;</span>), <span class="co"># allows for dge between treatment groups</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>                    <span class="dt">export_data_path =</span> <span class="kw">file.path</span>(my_filepath, <span class="st">&quot;my_cellcuratoR_objects/&quot;</span>))</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">## consider changing filepath to ~/Desktop or other directory that is easier to navigate to</span></span></code></pre></div>
<p>The directory structure of the exported dataset is as follows:</p>
<pre><code>|-- infb_shiny
|   |--seurat_obj.RData
|   |--seurat_obj_big.RData</code></pre>
<p>Once exported, we can now launch the cellcuratoR app and interact with the dataset. Upon launching the cellcuratoR shiny interface, we click the “Select Seurat Object Directory” button and navigate to our newly created directory, “~/Desktop/my_cellcurator_objects/.” Importantly, we do NOT navigate to the directory of the individual dataset (eg, do NOT navigate to “~/Desktop/my_cellcurator_objects/infb_shiny/”). Then, we can load our dataset with the “which dataset should be loaded?” dropdown and initiate exploratory data analysis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;exporting data to: &quot;</span>, my_filepath, <span class="st">&quot;my_cellcuratoR_objects/&quot;</span>))</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#&gt; [1] &quot;exporting data to: /private/var/folders/nl/mgz6zyb95zbgxdht85f6p5j8020vg6/T/RtmptVxGA7/temp_libpath127c1f880395/cellcuratoRmy_cellcuratoR_objects/&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># Launch the app with the following command (commented out for R-markdown)</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># cellcuratoR::launchApp()</span></span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># 1. Navigate to the our newly created directory printed above (or change to a more accesible directory for you)</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># 2. Select the &quot;infb_shiny&quot; dataset from the &quot;which dataset should be loaded?&quot; dropdown</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co"># 3. Interactively explore data!</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
